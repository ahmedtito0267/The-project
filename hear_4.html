<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Romantic Sky</title>
  <style>
    /* -------- كودك الأصلي كما هو بالضبط -------- */
    body {
      margin: 0;
      height: 100vh;
      background: radial-gradient(circle at bottom, #001d3d, #000814);
      overflow: hidden;
    }
    canvas { position: absolute; top: 0; left: 0; }

    .moon {
      position: absolute;
      top: 60px;
      right: 60px;
      width: 180px;
      height: 180px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #f5f3ce, #bbb 65%, #888 80%);
      box-shadow:
        inset -15px -15px 40px rgba(0,0,0,0.3),
        0 0 80px 40px rgba(255,255,200,0.4),
        0 0 140px 80px rgba(255,255,255,0.15);
      z-index: 2;
      filter: blur(0.5px);
    }

    .top-text {
      position: absolute;
      top: 100px;
      left: 50%;
      transform: translateX(-50%);
      font-family: "Segoe Script", cursive;
      font-size: 55px;
      font-weight: bold;
      background: linear-gradient(45deg, #ffd700, #ffec8b, #fff5b7);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow:
        2px 2px 6px rgba(0,0,0,0.6),
        0 0 20px #ffd700,
        0 0 40px #ffcc00;
      animation: floatText 3s infinite ease-in-out;
      z-index: 10;
      white-space: nowrap;
    }

    @keyframes floatText {
      0%, 100% { transform: translateX(-50%) translateY(0) scale(1); }
      50% { transform: translateX(-50%) translateY(-10px) scale(1.05); }
    }

    .star {
      position: absolute;
      border-radius: 50%;
      animation: twinkle 2s infinite alternate;
      transition: transform 1s ease, opacity 1s ease;
      will-change: transform, opacity;
    }
    @keyframes twinkle {
      from { opacity: 0.2; transform: scale(0.8); }
      to { opacity: 1; transform: scale(1.2); }
    }

    /* مشغل موسيقى ثلاثي الأبعاد */
    .music-player {
      position: absolute;
      bottom: 40px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255, 255, 255, 0.08);
      padding: 25px 30px;
      border-radius: 25px;
      display: flex;
      align-items: center;
      gap: 20px;
      box-shadow: 
        10px 10px 25px rgba(0,0,0,0.6),
        -10px -10px 25px rgba(255,255,255,0.08),
        inset 2px 2px 6px rgba(255,255,255,0.3),
        inset -2px -2px 6px rgba(0,0,0,0.4);
      backdrop-filter: blur(15px);
      z-index: 100;
      transform-style: preserve-3d;
      perspective: 1000px;
    }

    .music-player button {
      background: linear-gradient(145deg, #ff5f9e, #ff2d55);
      border: none;
      width: 55px;
      height: 55px;
      border-radius: 50%;
      font-size: 24px;
      color: white;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 
        4px 4px 8px rgba(0,0,0,0.5),
        -4px -4px 8px rgba(255,255,255,0.1);
    }

    .music-player button:hover {
      transform: scale(1.2) rotateY(15deg);
      box-shadow: 
        0 0 20px rgba(255, 77, 136, 0.8),
        inset 0 0 10px rgba(255,255,255,0.3);
    }

    #seekBar {
      flex: 1;
      height: 12px;
      border-radius: 10px;
      -webkit-appearance: none;
      background: linear-gradient(90deg, #ff2d55, #ff80ab);
      cursor: pointer;
      animation: glowBar 2s infinite alternate;
      box-shadow: inset 2px 2px 6px rgba(0,0,0,0.5),
                  inset -2px -2px 6px rgba(255,255,255,0.2);
    }

    #seekBar::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #fff, #ff2d55);
      box-shadow: 0 0 10px rgba(255,77,136,0.8);
      cursor: grab;
      transition: transform 0.2s;
    }

    #seekBar::-webkit-slider-thumb:hover {
      transform: scale(1.2);
    }

    @keyframes glowBar {
      from { box-shadow: 0 0 8px #ff2d55, inset 2px 2px 6px rgba(0,0,0,0.5); }
      to { box-shadow: 0 0 20px #ff80ab, inset 2px 2px 6px rgba(0,0,0,0.5); }
    }
  </style>

  <!-- إضافة CSS للصور المتساقطة (منفصل عن الكود الأصلي - لا يغيّر الأصلي) -->
  <style>
    /* طبقة الصور الساقطة: فوق الخلفية/القمر، تحت المشغل والنص */
    #falling-layer {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 5; /* فوق القمر (2) وتحت النص (10) و المشغل (100) */
      perspective: 900px;
      overflow: visible;
    }

    .falling-img {
      position: absolute;
      top: -180px;
      border-radius: 14px;
      object-fit: cover;
      filter: drop-shadow(0 12px 20px rgba(0,0,0,0.6));
      will-change: transform, opacity;
      transform-style: preserve-3d;
      animation: fall3d var(--dur, 9s) linear forwards;
      opacity: 0;
      backface-visibility: hidden;
    }

    @keyframes fall3d {
      0% {
        opacity: 0;
        transform: translateY(-180px) translateX(0) translateZ(var(--z, 0px)) rotateX(0deg) rotateY(0deg) rotateZ(0deg) scale(var(--scale,1));
      }
      10% { opacity: 1; }
      30% {
        transform: translateY(25vh) translateX(calc(var(--sway, 40px) * -1)) translateZ(var(--z, 0px))
                   rotateX(90deg) rotateY(60deg) rotateZ(60deg) scale(var(--scale,1));
      }
      55% {
        transform: translateY(60vh) translateX(var(--sway, 40px)) translateZ(calc(var(--z, 0px) * 0.6))
                   rotateX(180deg) rotateY(180deg) rotateZ(180deg) scale(calc(var(--scale,1) * 0.95));
      }
      85% {
        transform: translateY(95vh) translateX(calc(var(--sway, 40px) * -0.5)) translateZ(calc(var(--z, 0px) * 0.3))
                   rotateX(270deg) rotateY(240deg) rotateZ(270deg) scale(calc(var(--scale,1) * 0.9));
      }
      100% {
        opacity: 0;
        transform: translateY(110vh) translateX(0) translateZ(var(--z, 0px)) rotateX(360deg) rotateY(var(--rot, 360deg)) rotateZ(360deg) scale(var(--scale,1));
      }
    }
  </style>
</head>
<body>
  <div class="moon"></div>
  <canvas id="sky"></canvas>
  <canvas id="heartCanvas"></canvas>

  <!-- طبقة الصور المتساقطة (مضافة فقط) -->
  <div id="falling-layer" aria-hidden="true"></div>

  <div class="top-text">I LOVE YOU MOKA</div>

  <!-- مشغل الموسيقى -->
  <div class="music-player">
    <button id="backward">⏪</button>
    <button id="playPause">▶️</button>
    <button id="forward">⏩</button>
    <input type="range" id="seekBar" value="0" min="0" step="0.1">
  </div>

  <!-- ملف الصوت -->
  <audio id="bgMusic" loop>
    <source src="https://files.catbox.moe/mi6q7v.mp3" type="audio/mp3">
    متصفحك لا يدعم تشغيل الصوت
  </audio>

  <script>
    const sky = document.getElementById("sky"), ctxSky = sky.getContext("2d");
    const heartCanvas = document.getElementById("heartCanvas"), ctxHeart = heartCanvas.getContext("2d");
    sky.width = heartCanvas.width = window.innerWidth;
    sky.height = heartCanvas.height = window.innerHeight;

    const starColors = ["#ffffff","#aad7ff","#ffcaff","#d0d0ff","#ffeeaa"];
    for (let i = 0; i < 200; i++) {
      const star = document.createElement("div");
      star.className = "star";
      const s = Math.random() * 2 + 1;
      star.style.top = `${Math.random() * window.innerHeight}px`;
      star.style.left = `${Math.random() * window.innerWidth}px`;
      star.style.width = star.style.height = `${s}px`;
      star.style.background = starColors[Math.floor(Math.random() * starColors.length)];
      star.style.boxShadow = `0 0 ${8 + s*4}px ${s}px ${star.style.background}`;
      star.style.opacity = Math.random() * 0.8 + 0.2;
      const depth = Math.random() * 20 + 5;
      star.style.transform = `translateZ(${depth}px)`;
      document.body.appendChild(star);
    }

    document.addEventListener("mousemove", e => {
      const x = e.clientX / window.innerWidth - 0.5;
      const y = e.clientY / window.innerHeight - 0.5;
      document.querySelectorAll(".star").forEach(star => {
        const depth = parseFloat(star.style.transform.match(/translateZ\((.*)px\)/)[1]);
        star.style.transform = `translate(${x * depth * 0.5}px,${y * depth * 0.5}px) translateZ(${depth}px)`;
      });
    });

    function drawGeometricHeart(scale) {
      ctxHeart.clearRect(0,0,heartCanvas.width,heartCanvas.height);
      ctxHeart.save();
      ctxHeart.translate(heartCanvas.width/2, heartCanvas.height/2 + 50);
      ctxHeart.scale(scale, scale);
      const pts = [], size = 350;
      for (let a = 0; a < Math.PI*2; a += 0.1) {
        const x = 16 * Math.pow(Math.sin(a),3);
        const y = -(13 * Math.cos(a) -5 * Math.cos(2*a) -2 * Math.cos(3*a) - Math.cos(4*a));
        pts.push([x * size * 0.05, y * size * 0.05]);
      }
      ctxHeart.strokeStyle = "rgba(255, 0, 0, 0.9)";
      ctxHeart.lineWidth = 1.5;
      for (let i = 0; i < pts.length; i++) {
        for (let j = i+1; j < pts.length; j += Math.floor(Math.random()*6)+3) {
          ctxHeart.beginPath();
          ctxHeart.moveTo(pts[i][0], pts[i][1]);
          ctxHeart.lineTo(pts[j][0], pts[j][1]);
          ctxHeart.stroke();
        }
      }
      ctxHeart.restore();
    }

    (function animateHeart(t = 0) {
      requestAnimationFrame(() => animateHeart(t + 0.02));
      drawGeometricHeart(1 + Math.sin(t) * 0.07);
    })();

    class Firework {
      constructor(x, y, cs) {
        this.x = x; this.y = y;
        this.particles = Array.from({length: 60}, () => {
          const angle = Math.random() * 2 * Math.PI;
          const speed = Math.random()*4 + 2;
          return {
            x: this.x, y: this.y,
            vx: Math.cos(angle) * speed,
            vy: Math.sin(angle) * speed,
            alpha: 1,
            color: cs[Math.floor(Math.random()*cs.length)]
          };
        });
      }
      update() {
        this.particles.forEach(p => {
          p.x += p.vx;
          p.y += p.vy;
          p.vy += 0.02;
          p.alpha -= 0.01;
        });
      }
      draw(ctx) {
        this.particles.forEach(p => {
          if (p.alpha > 0) {
            ctx.globalAlpha = p.alpha;
            ctx.fillStyle = p.color;
            ctx.beginPath();
            ctx.arc(p.x, p.y, 2, 0, Math.PI*2);
            ctx.fill();
          }
        });
        ctx.globalAlpha = 1;
      }
    }

    let fireworks = [];
    function animateSky(){
      ctxSky.fillStyle = "rgba(0,0,0,0.2)";
      ctxSky.fillRect(0,0,sky.width,sky.height);
      fireworks.forEach((fw,i) => {
        fw.update(); fw.draw(ctxSky);
        if (fw.particles.every(p => p.alpha <= 0)) fireworks.splice(i,1);
      });
      requestAnimationFrame(animateSky);
    }
    animateSky();
    setInterval(() => {
      fireworks.push(new Firework(
        Math.random()*sky.width,
        Math.random()*sky.height/2,
        ["#ff4444","#ff7777","#ffaaaa","#ff0000"]
      ));
    }, 2000);

    // مشغل الموسيقى
    const music = document.getElementById("bgMusic");
    const playPauseBtn = document.getElementById("playPause");
    const seekBar = document.getElementById("seekBar");
    const forwardBtn = document.getElementById("forward");
    const backwardBtn = document.getElementById("backward");

    let isPlaying = false;

    playPauseBtn.addEventListener("click", () => {
      if (isPlaying) {
        music.pause();
        playPauseBtn.textContent = "▶️";
      } else {
        music.play();
        playPauseBtn.textContent = "⏸️";
      }
      isPlaying = !isPlaying;
    });

    forwardBtn.addEventListener("click", () => {
      music.currentTime += 10;
    });

    backwardBtn.addEventListener("click", () => {
      music.currentTime -= 10;
    });

    music.addEventListener("timeupdate", () => {
      seekBar.max = music.duration;
      seekBar.value = music.currentTime;
    });

    seekBar.addEventListener("input", () => {
      music.currentTime = seekBar.value;
    });

    document.body.addEventListener("click", () => {
      music.muted = false;
      music.play();
      playPauseBtn.textContent = "⏸️";
      isPlaying = true;
    }, { once: true });
  </script>

  <!-- سكربت الإضافة: صور متساقطة ثلاثية الأبعاد من Google Drive (مستقل عن الكود الأصلي) -->
  <script>
    (function(){
      const fallingLayer = document.getElementById('falling-layer');

      const images = [
        "https://files.catbox.moe/vffdnb.jpg",
        "https://files.catbox.moe/70a93y.jpg",
        "https://files.catbox.moe/ig7477.jpg",
        "https://files.catbox.moe/hf7v62.jpg",
        "https://files.catbox.moe/2r5bpk.jpg",
        "https://files.catbox.moe/a9so22.jpg",
        "https://files.catbox.moe/kzyn94.jpg",
        "https://files.catbox.moe/lb8ofl.jpg",
        "https://files.catbox.moe/byf3wn.jpg",
        "https://files.catbox.moe/vnptbz.jpg",
        "https://files.catbox.moe/u4jbxs.jpg",
        "https://files.catbox.moe/6jfko9.jpg",
        "https://files.catbox.moe/5jpbn2.jpg",
        "https://files.catbox.moe/i1qkfh.jpg",
        "https://files.catbox.moe/k2h99c.jpg",
        "https://files.catbox.moe/g7xw6g.jpg",
        "https://files.catbox.moe/xz2w7x.jpg",
        "https://files.catbox.moe/y4cpww.jpg",
        "https://files.catbox.moe/o3g3pn.jpg",
        "https://files.catbox.moe/gv0pdf.jpg",
        "https://files.catbox.moe/p1x7tj.jpg",
        "https://files.catbox.moe/gv0pdf.jpg",
        "https://files.catbox.moe/qk99oo.jpg",
        "https://files.catbox.moe/p1x7tj.jpg",
        "https://files.catbox.moe/nt8lkg.jpg",
        "https://files.catbox.moe/nla5sm.jpg",
        "https://files.catbox.moe/xj13wp.jpg",
        "https://files.catbox.moe/nla5sm.jpg",
        "https://files.catbox.moe/itfdlh.jpg",
        "https://files.catbox.moe/gy5rvf.jpg",
        "https://files.catbox.moe/nfmnoq.jpg",
        "https://files.catbox.moe/ec5inw.jpg",
        "https://files.catbox.moe/q438e0.jpg",
        "https://files.catbox.moe/moyqvh.jpg",
        "https://files.catbox.moe/lke5jd.jpg",
        "https://files.catbox.moe/9ioxef.jpg",
        "https://files.catbox.moe/6jf3cp.jpg",
        "https://files.catbox.moe/4df3z1.jpg",
        "https://files.catbox.moe/n3upai.jpg",
        "https://files.catbox.moe/qgrndd.jpg",
        "https://files.catbox.moe/5b0u53.jpg",
        "https://files.catbox.moe/1b67y6.jpg",
        "https://files.catbox.moe/tn40zh.jpg",
        "https://files.catbox.moe/ivkv5w.jpg",
        "https://files.catbox.moe/abma95.jpg",
        "https://files.catbox.moe/b8l0gb.jpg",
        "https://files.catbox.moe/sqfuf8.jpg",
        "https://files.catbox.moe/brslw9.jpg",
        "https://files.catbox.moe/jxz9az.jpg",
        "https://files.catbox.moe/jx7yfn.jpg",
        "https://files.catbox.moe/m01lx4.jpg",
        "https://files.catbox.moe/7cf5ic.jpg",
        "https://files.catbox.moe/g4tsli.jpg",
        "",

      ];

      // حماية: لا تنشئ أكثر من N عناصر في نفس الوقت
      let activeCount = 0;
      const MAX_ACTIVE = 30;

      function createFallingImage(){
        if (activeCount >= MAX_ACTIVE) return;
        const src = images[Math.floor(Math.random() * images.length)];
        const img = document.createElement('img');
        img.className = 'falling-img';
        img.loading = 'lazy';
        img.decoding = 'async';

        // نسند المصدر أولاً — لو فشل تحميله سيتم حذف العنصر في حدث error
        img.src = src;

        // الحجم (عرض) عشوائي بين 40 و 140
        const size = Math.floor(40 + Math.random() * 100);
        img.style.width = size + 'px';
        img.style.height = 'auto';

        // موضع أفقي عشوائي
        const maxLeft = Math.max(0, window.innerWidth - size);
        img.style.left = Math.floor(Math.random() * maxLeft) + 'px';

        // مدة السقوط
        const dur = (6 + Math.random() * 6).toFixed(2); // 6s - 12s
        img.style.setProperty('--dur', dur + 's');

        // تمايل أفقي (sway): يمكن أن يكون موجب أو سالب
        const sway = Math.floor(20 + Math.random() * 140) * (Math.random() < 0.5 ? -1 : 1);
        img.style.setProperty('--sway', sway + 'px');

        // دوران نهائي عشوائي
        const rot = Math.floor(90 + Math.random() * 720);
        img.style.setProperty('--rot', rot + 'deg');

        // عمق ثلاثي الأبعاد (translateZ) لتباين السرعة والحجم المرئي
        const z = Math.floor(-300 + Math.random() * 600); // -300px .. +300px
        img.style.setProperty('--z', z + 'px');

        // مقياس بسيط مرتبط بالعمق (أبعد = أصغر قليلاً)
        const scale = (100 + (z / 120)) / 100; // قيمة قريبة من 0.5 - 1.5
        img.style.setProperty('--scale', Math.max(0.55, Math.min(scale, 1.3)).toString());

        // إزالة العنصر عند نهاية الأنيميشن أو في حالة الخطأ
        const clean = () => {
          if (img.parentNode) img.parentNode.removeChild(img);
          activeCount = Math.max(0, activeCount - 1);
        };
        img.addEventListener('animationend', clean, { once: true });
        img.addEventListener('error', clean, { once: true });

        // العدّ الفعّال للعناصر
        activeCount++;
        fallingLayer.appendChild(img);
      }

      // مؤقت / تحكم
      let fallTimer = null;
      function startFalling(){
        if (fallTimer) return;
        // دفعة افتتاحية لتأثير جميل
        for (let i = 0; i < 10; i++) setTimeout(createFallingImage, i * 130);
        fallTimer = setInterval(createFallingImage, 420);
      }
      function stopFalling(){
        clearInterval(fallTimer);
        fallTimer = null;
      }

      // ربط مع مشغل الأغنية (مستقل عن كودك الأصلي)
      const bgMusic = document.getElementById('bgMusic');
      if (bgMusic) {
        bgMusic.addEventListener('play', startFalling);
        bgMusic.addEventListener('pause', stopFalling);
        bgMusic.addEventListener('ended', stopFalling);
      }

      // تحسين الأداء عند تبديل التبويب
      document.addEventListener('visibilitychange', () => {
        if (document.hidden) stopFalling();
        else if (bgMusic && !bgMusic.paused) startFalling();
      });

      // تنظيف عند إغلاق الصفحة
      window.addEventListener('beforeunload', () => {
        stopFalling();
      });

      // تكيّف عند تغيير حجم النافذة
      window.addEventListener('resize', () => { /* العناصر الجديدة ستأخذ المواضع الصحيحة */ });

      // إذا أردت تشغيلها مباشرة بدون انتظار تشغيل الموسيقى، فك التعليق التالي:
      // startFalling();
    })();
  </script>
</body>
</html>
